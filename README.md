# tbls MCP Server

A Model Context Protocol (MCP) server that provides access to database schema information generated by [tbls](https://github.com/k1LoW/tbls) and enables SQL query execution on MySQL and SQLite databases.

## Features

- **Schema Information Access**: Expose tbls-generated markdown schema files as MCP resources
- **Multiple Resource Types**: Access schemas, tables, and index information
- **SQL Query Execution**: Execute SELECT queries on MySQL and SQLite databases with built-in security
- **Type Safety**: Full TypeScript implementation with zod validation
- **Error Handling**: Robust error handling using neverthrow Result types

## Installation

### Via npx (Recommended)

```bash
npx tbls-mcp-server
```

### Local Installation

```bash
npm install -g tbls-mcp-server
```

## Usage

### Basic Usage

```bash
tbls-mcp-server --schema-dir /path/to/tbls/output
```

### With Database Connection

```bash
tbls-mcp-server \
  --schema-dir /path/to/tbls/output \
  --database-url mysql://user:pass@localhost:3306/mydb
```

## MCP Resources

The server provides the following MCP resources:

### Schema List
- **URI**: `schema://list`
- **Description**: List all available database schemas

### Table List
- **URI**: `schema://{schema_name}/tables`
- **Description**: List all tables in a specific schema

### Table Information
- **URI**: `table://{schema_name}/{table_name}`
- **Description**: Detailed table information including columns, types, and constraints

### Index Information
- **URI**: `table://{schema_name}/{table_name}/indexes`
- **Description**: Index information for a specific table

## MCP Tools

### SQL Query Execution
- **Name**: `execute-sql`
- **Description**: Execute SELECT queries on connected databases
- **Security**: Only SELECT statements are allowed for security reasons

## Configuration

### Environment Variables

- `TBLS_SCHEMA_DIR`: Directory containing tbls markdown files
- `DATABASE_URL`: Database connection string (optional)
- `LOG_LEVEL`: Logging level (debug, info, warn, error)

### Configuration File

Create a `.tbls-mcp-server.json` file:

```json
{
  "schemaDir": "/path/to/tbls/output",
  "databaseUrl": "mysql://user:pass@localhost:3306/mydb",
  "logLevel": "info"
}
```

## Development

### Prerequisites

- Node.js 18+
- npm or yarn

### Setup

```bash
git clone https://github.com/your-username/tbls-mcp-server.git
cd tbls-mcp-server
npm install
```

### Development Commands

```bash
# Start development server
npm run dev

# Run tests
npm test

# Run tests with coverage
npm run test:coverage

# Build for production
npm run build

# Run linter
npm run lint
```

### Testing

The project uses Jest for testing with a focus on Test-Driven Development (TDD):

```bash
# Run all tests
npm test

# Run tests in watch mode
npm run test:watch

# Generate coverage report
npm run test:coverage
```

## Architecture

The server is built using:

- **TypeScript**: Type-safe implementation
- **@modelcontextprotocol/sdk**: Official MCP SDK
- **neverthrow**: Result types for error handling
- **zod**: Schema validation
- **mysql2**: MySQL database connectivity
- **sqlite3**: SQLite database connectivity

## Security

- Only SELECT statements are permitted for SQL execution
- Input validation using zod schemas
- SQL injection prevention through parameterized queries
- Connection string validation and sanitization

## Contributing

1. Fork the repository
2. Create a feature branch
3. Write tests for your changes
4. Implement your changes
5. Ensure all tests pass
6. Submit a pull request

## License

ISC License

## Related Projects

- [tbls](https://github.com/k1LoW/tbls) - Schema documentation tool
- [Model Context Protocol](https://modelcontextprotocol.io/) - Protocol specification